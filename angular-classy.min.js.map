{"version":3,"file":"angular-classy.min.js","sources":["angular-classy.js"],"names":["availablePlugins","alreadyRegisteredModules","getActiveClassyPlugins","name","origModule","getNextRequires","module","angular","i","requires","length","pluginName","plugin","obj","replace","__classyDefaults","copy","options","pluginDo","methodName","params","callbacks","plugins","classy","activePlugins","__options","prototype","pluginKeys","Object","keys","classyOptions","isFunction","before","returnVal","apply","after","copyAndExtendDeep","dst","key","value","_i","_len","arguments","constructor","origModuleMethod","reqs","configFn","activeClassyPlugins","controller","classObj","classyController","classFns","init","this","preInit","controllers","controllerArray","cC","cCs","localInject","classConstructor","buildConstructor","buildOptions","classKeys","hasOwnProperty","option","optionName","shorthandOptions","optionNames","j","isObject","k","extend","klass","$inject","injectIndex","deps","__classDepNames","isArray","depName","pluginPromises","then","push","initClass","postInit","boundClass","bind","all","enabled","addToScope","addToClass","privatePrefix","keyName","hasPrivatePrefix","string","prefix","slice","dataProp","data","call","isString","getter","$parse","fnKey","fnValue","$scope","scopeShortcut","depNames","inject","pluginDepNames","concat","initBefore","preDeps","ignore","__indexOf","indexOf","item","l","methods","boundMethod","method","bindWatchToClass","_watchKeywords","normal","objectEquality","collection","isActive","watch","Error","watchFns","expression","fn","$watch","$watchCollection","convertToFunctionExpression","context","parse","watchKeywords","watchRegistered","watchType","watchFn","keywords","keyword","normalizedExpression","exp"],"mappings":"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","sourcesContent":[";(function() {\n/*\nAngular Classy 1.1.0\nDave Jeffery, @DaveJ\nLicense: MIT\n */\n\n/* global angular */\nvar availablePlugins = {};\n\nvar alreadyRegisteredModules = {};\n\nvar getActiveClassyPlugins = function(name, origModule) {\n  // TODO: Write a test to ensure that this method gets called the correct amount of times\n\n  var getNextRequires = function(name) {\n    if (alreadyRegisteredModules[name]) {\n      var module = angular.module(name);\n\n      // for pluginName in module.requires\n      for (var i = 0; i < module.requires.length; i++) {\n        var pluginName = module.requires[i];\n        var plugin = availablePlugins[pluginName];\n        if (plugin) {\n          obj[pluginName] = plugin;\n          if (!plugin.name) {\n            plugin.name = pluginName.replace('classy.', '');\n          }\n          if (!origModule.__classyDefaults) {\n            origModule.__classyDefaults = {};\n          }\n          origModule.__classyDefaults[plugin.name] = angular.copy(plugin.options || {});\n        }\n        getNextRequires(pluginName);\n      }\n    }\n  };\n\n  var obj = {};\n  alreadyRegisteredModules[name] = true;\n  getNextRequires(name);\n  return obj;\n};\n\n\n/**\n* Runs a particular stage of the lifecycle for all plugins.\n* Also runs the `before` and `after` callbacks if specified.\n*/\nvar pluginDo = function(methodName, params, callbacks) {\n  // params = [klass, deps, module];\n\n  var plugins = params[2].classy.activePlugins;\n  var options = params[0].__options || params[0].prototype.__options;\n\n  // for plugin of plugins\n  var pluginKeys = Object.keys(plugins);\n  for (var i = 0; i < pluginKeys.length; i++) {\n    var plugin = plugins[pluginKeys[i]];\n    plugin.options = options[plugin.name] || {};\n    plugin.classyOptions = options;\n\n    if (callbacks && angular.isFunction(callbacks.before)) {\n      callbacks.before(plugin);\n    }\n\n    var returnVal;\n    if (plugin && methodName && angular.isFunction(plugin[methodName])) {\n      returnVal = plugin[methodName].apply(plugin, params);\n    }\n\n    if (callbacks && angular.isFunction(callbacks.after)) {\n      callbacks.after(plugin, returnVal);\n    }\n  }\n};\n\n\n/**\n* Utility method to take an object and extend it with other objects\n* It does this recursively (deep) on inner objects too.\n*/\nvar copyAndExtendDeep = function(dst) {\n  var key, obj, value, _i, _len;\n  for (_i = 0, _len = arguments.length; _i < _len; _i++) {\n    obj = arguments[_i];\n    if (obj !== dst) {\n      for (key in obj) {\n        value = obj[key];\n        if (dst[key] && dst[key].constructor && dst[key].constructor === Object) {\n          copyAndExtendDeep(dst[key], value);\n        } else {\n          dst[key] = angular.copy(value);\n        }\n      }\n    }\n  }\n  return dst;\n};\n\nvar origModuleMethod = angular.module;\n\nangular.module = function(name, reqs, configFn) {\n  /*\n   * We have to monkey-patch the `angular.module` method to see if 'classy' has been specified\n   * as a requirement. We also need the module name to we can register our classy controllers.\n   * Unfortunately there doesn't seem to be a more pretty/pluggable way to this.\n   */\n\n  var module = origModuleMethod(name, reqs, configFn);\n\n  if (reqs) {\n    if (name === 'classy.core') {\n      availablePlugins[name] = {};\n    }\n\n    var activeClassyPlugins = getActiveClassyPlugins(name, module);\n    if (activeClassyPlugins['classy.core']) {\n      module.classy = {\n        plugin: {\n          controller: function(plugin) { availablePlugins[name] = plugin; }\n        },\n        options: {\n          controller: {}\n        },\n        activePlugins: activeClassyPlugins,\n        controller: function(classObj) {\n            /*\n            * `classyController` contains only a set of proxy functions for `classFns`,\n            * this is because I suspect that performance is better this way.\n            * TODO: Test performance to see if this is the most performant way to do it.\n            */\n\n            // Pre-initialisation (before instance is created)\n            classFns.preInit(classyController, classObj, module);\n\n            function classyController() {\n              // Initialisation (after instance is created)\n              classFns.init(this, arguments, module);\n            }\n\n            return classyController;\n        },\n        /**\n         * Accepts an array of controllers and returns the module, e.g.:\n         * `module.classy.controllers([xxx, xxx]).config(xxx).run(xxx)`\n         * Requested in issue #29\n         */\n        controllers: function(controllerArray) {\n          // for classObj in controllerArray\n          for (var i = 0; i < controllerArray.length; i++) {\n            this.controller(controllerArray[i]);\n          }\n\n          return module;\n        }\n      };\n      module.cC = module.classy.controller;\n      module.cCs = module.classy.controllers;\n    }\n  }\n  return module;\n};\n\n\nvar classFns = {\n\n  localInject: ['$q'],\n\n  preInit: function(classConstructor, classObj, module) {\n    this.buildConstructor(classConstructor, classObj);\n    this.buildOptions(classConstructor, classObj, module);\n\n    pluginDo('preInitBefore', [classConstructor, classObj, module]);\n    pluginDo('preInit', [classConstructor, classObj, module]);\n    pluginDo('preInitAfter', [classConstructor, classObj, module]);\n  },\n\n  /**\n   * Add properties from class object onto the class constructor\n   */\n  buildConstructor: function(classConstructor, classObj) {\n    // for key of classObj\n    var classKeys = Object.keys(classObj);\n    for (var i = 0; i < classKeys.length; i++) {\n      var key = classKeys[i];\n      if (!classObj.hasOwnProperty(key)) continue;\n      classConstructor.prototype[key] = classObj[key];\n    }\n  },\n\n  /**\n   * Build options object for all classy plugins\n   */\n  buildOptions: function(classConstructor, classObj, module) {\n    var options = copyAndExtendDeep({}, module.__classyDefaults, module.classy.options.controller, classObj.__options);\n    var shorthandOptions = {};\n\n    // Collect shorthand options\n    var option, optionName;\n    var optionNames = Object.keys(options);\n    for (var j = 0; j < optionNames.length; j++) {\n      optionName = optionNames[j];\n      option = options[optionNames[j]];\n      if (!angular.isObject(option)) {\n        shorthandOptions[optionName] = option;\n      }\n    }\n\n    // Apply shorthand options to plugin options\n    if (Object.keys(shorthandOptions).length) {\n      for (var k = 0; k < optionNames.length; k++) {\n        optionName = optionNames[k];\n        option = options[optionNames[k]];\n        if (angular.isObject(option)) {\n          angular.extend(option, shorthandOptions);\n        }\n      }\n    }\n\n    classConstructor.prototype.__options = options;\n  },\n\n  init: function(klass, $inject, module) {\n    var injectIndex = 0;\n    var deps = {};\n\n    // for key in klass.constructor.__classDepNames\n    for (var i = 0; i < klass.constructor.__classDepNames.length; i++) {\n      var key = klass.constructor.__classDepNames[i];\n      deps[key] = $inject[injectIndex];\n      injectIndex++;\n    }\n    pluginDo(null, [klass, deps, module], {\n      before: function(plugin) {\n        if (angular.isArray(plugin.localInject)) {\n          // for depName in plugin.localInject\n          for (var j = 0; j < plugin.localInject.length; j++) {\n            var depName = plugin.localInject[j];\n            plugin[depName] = $inject[injectIndex];\n            injectIndex++;\n          }\n        }\n      }\n    });\n\n    pluginDo('initBefore', [klass, deps, module]);\n\n    var pluginPromises = [];\n    pluginDo('init', [klass, deps, module], {\n      after: function(plugin, returnVal) {\n        if (returnVal && returnVal.then) {\n          // Naively assume this is a promise\n          pluginPromises.push(returnVal);\n        }\n      }\n    });\n\n    var initClass = function() {\n      if (angular.isFunction(klass.init)) {\n        klass.init();\n      }\n      pluginDo('initAfter', [klass, deps, module]);\n      this.postInit(klass, deps, module);\n    };\n    var boundClass = angular.bind(this, initClass);\n    if (pluginPromises.length) {\n      // Injected dependency below is $q\n      $inject[injectIndex].all(pluginPromises).then(boundClass);\n    } else {\n      boundClass();\n    }\n  },\n  postInit: function(klass, deps, module) {\n    pluginDo('postInitBefore', [klass, deps, module]);\n    pluginDo('postInit', [klass, deps, module]);\n    pluginDo('postInitAfter', [klass, deps, module]);\n  }\n};\n\nangular.module('classy.core', []);\n\nangular.module('classy.bindData', ['classy.core']).classy.plugin.controller({\n  localInject: ['$parse'],\n  options: {\n    enabled: true,\n    addToScope: true,\n    addToClass: true,\n    privatePrefix: '_',\n    keyName: 'data'\n  },\n  hasPrivatePrefix: function(string) {\n    var prefix = this.options.privatePrefix;\n    if (!prefix) {\n      return false;\n    } else {\n      return string.slice(0, prefix.length) === prefix;\n    }\n  },\n  init: function(klass, deps, module) {\n    // Adds objects returned by or set to the `$scope`\n    var dataProp = klass.constructor.prototype[this.options.keyName];\n    if (this.options.enabled && dataProp) {\n      var data = angular.copy(dataProp);\n      if (angular.isFunction(data)) {\n        data = data.call(klass);\n      } else if (angular.isObject(data)) {\n        for (var key in data) {\n          var value = data[key];\n          if (angular.isString(value)) {\n            var getter = this.$parse(value);\n            data[key] = getter(klass);\n          } else {\n            data[key] = value;\n          }\n        }\n      }\n      for (var fnKey in data) {\n        var fnValue = data[fnKey];\n        if (this.options.addToClass) {\n          klass[fnKey] = fnValue;\n        }\n        if (this.options.addToScope && !this.hasPrivatePrefix(fnKey) && deps.$scope) {\n          deps.$scope[fnKey] = fnValue;\n        }\n      }\n    }\n  }\n});\n\nangular.module('classy.bindDependencies', ['classy.core']).classy.plugin.controller({\n  options: {\n    enabled: true,\n    scopeShortcut: '$'\n  },\n  preInit: function(classConstructor, classObj, module) {\n    var depNames = classObj.inject || [];\n    if (angular.isArray(depNames)) {\n      this.inject(classConstructor, depNames, module);\n    }\n  },\n  inject: function(classConstructor, depNames, module) {\n    var pluginDepNames = [];\n    for (var pluginName in module.classy.activePlugins) {\n      var plugin = module.classy.activePlugins[pluginName];\n      if (angular.isArray(plugin.localInject)) {\n        pluginDepNames = pluginDepNames.concat(plugin.localInject);\n      }\n    }\n    pluginDepNames = pluginDepNames.concat(classFns.localInject);\n    classConstructor.__classDepNames = angular.copy(depNames);\n    classConstructor.$inject = depNames.concat(pluginDepNames);\n  },\n  initBefore: function(klass, deps, module) {\n    if (this.options.enabled) {\n      var preDeps = klass.constructor.$inject;\n      for (var i = 0; i < preDeps.length; ++i) {\n        var key = preDeps[i];\n        klass[key] = deps[key];\n        if (key === '$scope' && this.options.scopeShortcut) {\n          klass[this.options.scopeShortcut] = klass[key];\n        }\n      }\n    }\n  }\n});\n\nangular.module('classy.bindMethods', ['classy.core']).classy.plugin.controller({\n  localInject: ['$parse'],\n  options: {\n    enabled: true,\n    addToScope: true,\n    addToClass: true,\n    privatePrefix: '_',\n    ignore: ['constructor', 'init'],\n    keyName: 'methods'\n  },\n  hasPrivatePrefix: function(string) {\n    var prefix;\n    prefix = this.options.privatePrefix;\n    if (!prefix) {\n      return false;\n    } else {\n      return string.slice(0, prefix.length) === prefix;\n    }\n  },\n  init: function(klass, deps, module) {\n    // indexOf shim for IE <= 8\n    var __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };\n\n    if (this.options.enabled) {\n      var methods = klass.constructor.prototype[this.options.keyName];\n      for (var key in methods) {\n        var method = methods[key];\n\n        var boundMethod;\n        if (angular.isFunction(method) && !(__indexOf.call(this.options.ignore, key) >= 0)) {\n          boundMethod = angular.bind(klass, method);\n        } else if (angular.isString(method)) {\n          var getter = this.$parse(method);\n          boundMethod = function() {\n            return getter(klass);\n          };\n        }\n        if (angular.isFunction(boundMethod)) {\n          if (this.options.addToClass) {\n            klass[key] = boundMethod;\n          }\n          if (this.options.addToScope && !this.hasPrivatePrefix(key) && deps.$scope) {\n            deps.$scope[key] = boundMethod;\n          }\n        }\n      }\n    }\n  }\n});\n\nangular.module('classy.register', ['classy.core']).classy.plugin.controller({\n  options: {\n    enabled: true,\n    key: 'name'\n  },\n  preInit: function(classConstructor, classObj, module) {\n    if (this.options.enabled && angular.isString(classObj[this.options.key])) {\n      module.controller(classObj[this.options.key], classConstructor);\n    }\n  }\n});\n\nangular.module('classy.watch', ['classy.core']).classy.plugin.controller({\n  localInject: ['$parse'],\n  options: {\n    enabled: true,\n    bindWatchToClass: false,\n    _watchKeywords: {\n      normal: [],\n      objectEquality: ['{object}', '{deep}'],\n      collection: ['{collection}', '{shallow}']\n    }\n  },\n  isActive: function(klass, deps) {\n    if (this.options.enabled && angular.isObject(klass.watch)) {\n      if (!deps.$scope) {\n        throw new Error(\"You need to inject `$scope` to use the watch object\");\n        return false;\n      }\n      return true;\n    }\n  },\n  watchFns: {\n    normal: function(klass, expression, fn, deps) {\n      return deps.$scope.$watch(expression, angular.bind(klass, fn));\n    },\n    objectEquality: function(klass, expression, fn, deps) {\n      return deps.$scope.$watch(expression, angular.bind(klass, fn), true);\n    },\n    collection: function(klass, expression, fn, deps) {\n      return deps.$scope.$watchCollection(expression, angular.bind(klass, fn));\n    }\n  },\n  convertToFunctionExpression: function(expression, context) {\n    var parse = this.$parse;\n    return function() {\n      return parse(expression)(context);\n    };\n  },\n  postInit: function(klass, deps, module) {\n    if (!this.isActive(klass, deps)) {\n      return;\n    }\n    var watchKeywords = this.options._watchKeywords;\n\n    // for expression, fn of klass.watch\n    for (var expression in klass.watch) {\n      var fn = klass.watch[expression];\n      if (angular.isString(fn)) {\n        fn = klass[fn];\n      }\n      if (angular.isString(expression) && angular.isFunction(fn)) {\n        var watchRegistered = false;\n\n        // Search for keywords that identify it is a non-standard watch\n        // for watchType, watchFn of @watchFns\n        for (var watchType in this.watchFns) {\n          var watchFn = this.watchFns[watchType];\n          if (watchRegistered) {\n            break;\n          }\n          // for keyword in watchKeywords[watchType]\n          var keywords = watchKeywords[watchType];\n          for (var i = 0; i < keywords.length; i++) {\n            var keyword = keywords[i];\n\n            if (expression.indexOf(keyword) !== -1) {\n              var normalizedExpression = expression.replace(keyword, '');\n\n              var exp = this.options.bindWatchToClass ?\n                this.convertToFunctionExpression(normalizedExpression, klass) :\n                normalizedExpression;\n\n              watchFn(klass, exp, fn, deps);\n              watchRegistered = true;\n              break;\n            }\n          }\n        }\n        if (!watchRegistered) {\n          // If no keywords have been found then register it as a normal watch\n          var exp = this.options.bindWatchToClass ?\n            this.convertToFunctionExpression(expression, klass) :\n            expression;\n          this.watchFns.normal(klass, exp, fn, deps);\n        }\n      }\n    }\n  }\n});\n\nangular.module('classy', [\"classy.bindData\",\"classy.bindDependencies\",\"classy.bindMethods\",\"classy.core\",\"classy.register\",\"classy.watch\"]);\n})();"],"sourceRoot":"/source/"}